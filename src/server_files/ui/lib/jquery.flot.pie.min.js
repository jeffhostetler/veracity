(function(b){function c(E){var j=null;var J=0;var f=0;var N=null;var o=null;var C=null;var q=null;var O=0;var G=true;var p=10;var z=0.95;var B=0;var d=false;var A=false;var k=[];E.hooks.processOptions.push(h);E.hooks.bindEvents.push(e);function h(Q,P){if(P.series.pie.show){P.grid.show=false;if(P.series.pie.label.show=="auto"){if(P.legend.show){P.series.pie.label.show=false}else{P.series.pie.label.show=true}}if(P.series.pie.radius=="auto"){if(P.series.pie.label.show){P.series.pie.radius=3/4}else{P.series.pie.radius=1}}if(P.series.pie.tilt>1){P.series.pie.tilt=1}else{if(P.series.pie.tilt<0){P.series.pie.tilt=0}}Q.hooks.processDatapoints.push(F);Q.hooks.drawOverlay.push(I);Q.hooks.draw.push(s)}}function e(R,P){var Q=R.getOptions();if(Q.series.pie.show){if(Q.grid.hoverable){P.unbind("mousemove").mousemove(u)}if(Q.grid.clickable){P.unbind("click").click(m)}}}function H(Q){var R="";function P(U,V){if(!V){V=0}for(var T=0;T<U.length;++T){for(var S=0;S<V;S++){R+="\t"}if(typeof U[T]=="object"){R+=""+T+":\n";P(U[T],V+1)}else{R+=""+T+": "+U[T]+"\n"}}}P(Q);alert(R)}function r(R){for(var P=0;P<R.length;++P){var Q=parseFloat(R[P].data[0][1]);if(Q){O+=Q}}}function F(S,P,Q,R){if(!d){d=true;j=S.getCanvas();N=b(j).parent();a=S.getOptions();J=S.getPlaceholder().width();f=S.getPlaceholder().height();S.setData(M(S.getData()))}}function K(){B=N.children().filter(".legend").children().width()||0;o=Math.min(J,f/a.series.pie.tilt)/2;q=f/2+a.series.pie.offset.top;C=J/2;if(a.series.pie.offset.left=="auto"){if(a.legend.position.match("w")){C+=B/2}else{C-=B/2}}else{C+=a.series.pie.offset.left}if(C<o){C=o}else{if(C>J-o){C=J-o}}}function w(Q){for(var P=0;P<Q.length;++P){if(typeof(Q[P].data)=="number"){Q[P].data=[[1,Q[P].data]]}else{if(typeof(Q[P].data)=="undefined"||typeof(Q[P].data[0])=="undefined"){if(typeof(Q[P].data)!="undefined"&&typeof(Q[P].data.label)!="undefined"){Q[P].label=Q[P].data.label}Q[P].data=[[1,0]]}}}return Q}function M(S){S=w(S);r(S);var R=0;var U=0;var P=a.series.pie.combine.color;var T=[];for(var Q=0;Q<S.length;++Q){S[Q].data[0][1]=parseFloat(S[Q].data[0][1]);if(!S[Q].data[0][1]){S[Q].data[0][1]=0}if(S[Q].data[0][1]/O<=a.series.pie.combine.threshold){R+=S[Q].data[0][1];U++;if(!P){P=S[Q].color}}else{T.push({data:[[1,S[Q].data[0][1]]],color:S[Q].color,label:S[Q].label,angle:S[Q].data[0][1]*Math.PI*2/O,percent:S[Q].data[0][1]/O*100})}}if(U>0){T.push({data:[[1,R]],color:P,label:a.series.pie.combine.label,angle:R*Math.PI*2/O,percent:R/O*100})}return T}function s(U,S){if(!N){return}ctx=S;K();var V=U.getData();var R=0;while(G&&R<p){G=false;if(R>0){o*=z}R+=1;P();if(a.series.pie.tilt<=0.8){Q()}T()}if(R>=p){P();N.prepend("<div class='error'>Could not draw pie with labels contained inside canvas</div>")}if(U.setSeries&&U.insertLegend){U.setSeries(V);U.insertLegend()}function P(){ctx.clearRect(0,0,J,f);N.children().filter(".pieLabel, .pieLabelBackground").remove()}function Q(){var ab=a.series.pie.shadow.left;var aa=a.series.pie.shadow.top;var Y=10;var Z=a.series.pie.shadow.alpha;var W=a.series.pie.radius>1?a.series.pie.radius:o*a.series.pie.radius;if(W>=J/2-ab||W*a.series.pie.tilt>=f/2-aa||W<=Y){return}ctx.save();ctx.translate(ab,aa);ctx.globalAlpha=Z;ctx.fillStyle="#000";ctx.translate(C,q);ctx.scale(1,a.series.pie.tilt);for(var X=1;X<=Y;X++){ctx.beginPath();ctx.arc(0,0,W,0,Math.PI*2,false);ctx.fill();W-=X}ctx.restore()}function T(){var Z=Math.PI*a.series.pie.startAngle;var W=a.series.pie.radius>1?a.series.pie.radius:o*a.series.pie.radius;ctx.save();ctx.translate(C,q);ctx.scale(1,a.series.pie.tilt);ctx.save();var ab=Z;for(var Y=0;Y<V.length;++Y){V[Y].startAngle=ab;aa(V[Y].angle,V[Y].color,true)}ctx.restore();if(a.series.pie.stroke.width>0){ctx.save();ctx.lineWidth=a.series.pie.stroke.width;ab=Z;for(var Y=0;Y<V.length;++Y){aa(V[Y].angle,a.series.pie.stroke.color,false)}ctx.restore()}L(ctx);if(a.series.pie.label.show){X()}ctx.restore();function aa(ae,ac,ad){if(ae<=0||isNaN(ae)){return}if(ad){ctx.fillStyle=ac}else{ctx.strokeStyle=ac;ctx.lineJoin="round"}ctx.beginPath();if(Math.abs(ae-Math.PI*2)>1e-9){ctx.moveTo(0,0)}else{if(b.browser.msie){ae-=0.0001}}ctx.arc(0,0,W,ab,ab+ae/2,false);ctx.arc(0,0,W,ab+ae/2,ab+ae,false);ctx.closePath();ab+=ae;if(ad){ctx.fill()}else{ctx.stroke()}}function X(){var af=Z;var ac=a.series.pie.label.radius>1?a.series.pie.label.radius:o*a.series.pie.label.radius;for(var ae=0;ae<V.length;++ae){if(V[ae].percent>=a.series.pie.label.threshold*100){ad(V[ae],af,ae)}af+=V[ae].angle}function ad(at,al,aj){if(at.data[0][1]==0){return}var av=a.legend.labelFormatter,au,ah=a.series.pie.label.formatter;if(av){au=av(at.label,at)}else{au=at.label}if(ah){au=ah(au,at)}var am=((al+at.angle)+al)/2;var ar=C+Math.round(Math.cos(am)*ac);var ap=q+Math.round(Math.sin(am)*ac)*a.series.pie.tilt;var ai="<span class='pieLabel' id='pieLabel"+aj+"' style='position:absolute;top:"+ap+"px;left:"+ar+"px;'>"+au+"</span>";N.append(ai);var aq=N.children("#pieLabel"+aj);var ag=(ap-aq.height()/2);var ak=(ar-aq.width()/2);aq.css("top",ag);aq.css("left",ak);if(0-ag>0||0-ak>0||f-(ag+aq.height())<0||J-(ak+aq.width())<0){G=true}if(a.series.pie.label.background.opacity!=0){var an=a.series.pie.label.background.color;if(an==null){an=at.color}var ao="top:"+ag+"px;left:"+ak+"px;";b("<div class='pieLabelBackground' style='position:absolute;width:"+aq.width()+"px;height:"+aq.height()+"px;"+ao+"background-color:"+an+";'></div>").css("opacity",a.series.pie.label.background.opacity).insertBefore(aq)}}}}}function L(P){if(a.series.pie.innerRadius>0){P.save();innerRadius=a.series.pie.innerRadius>1?a.series.pie.innerRadius:o*a.series.pie.innerRadius;P.globalCompositeOperation="destination-out";P.beginPath();P.fillStyle=a.series.pie.stroke.color;P.arc(0,0,innerRadius,0,Math.PI*2,false);P.fill();P.closePath();P.restore();P.save();P.beginPath();P.strokeStyle=a.series.pie.stroke.color;P.arc(0,0,innerRadius,0,Math.PI*2,false);P.stroke();P.closePath();P.restore()}}function t(S,T){for(var U=false,R=-1,P=S.length,Q=P-1;++R<P;Q=R){((S[R][1]<=T[1]&&T[1]<S[Q][1])||(S[Q][1]<=T[1]&&T[1]<S[R][1]))&&(T[0]<(S[Q][0]-S[R][0])*(T[1]-S[R][1])/(S[Q][1]-S[R][1])+S[R][0])&&(U=!U)}return U}function v(T,R){var V=E.getData();var Q=E.getOptions();var P=Q.series.pie.radius>1?Q.series.pie.radius:o*Q.series.pie.radius;for(var S=0;S<V.length;++S){var U=V[S];if(U.pie.show){ctx.save();ctx.beginPath();ctx.moveTo(0,0);ctx.arc(0,0,P,U.startAngle,U.startAngle+U.angle/2,false);ctx.arc(0,0,P,U.startAngle+U.angle/2,U.startAngle+U.angle,false);ctx.closePath();x=T-C;y=R-q;if(ctx.isPointInPath){if(ctx.isPointInPath(T-C,R-q)){ctx.restore();return{datapoint:[U.percent,U.data],dataIndex:0,series:U,seriesIndex:S}}}else{p1X=P*Math.cos(U.startAngle);p1Y=P*Math.sin(U.startAngle);p2X=P*Math.cos(U.startAngle+U.angle/4);p2Y=P*Math.sin(U.startAngle+U.angle/4);p3X=P*Math.cos(U.startAngle+U.angle/2);p3Y=P*Math.sin(U.startAngle+U.angle/2);p4X=P*Math.cos(U.startAngle+U.angle/1.5);p4Y=P*Math.sin(U.startAngle+U.angle/1.5);p5X=P*Math.cos(U.startAngle+U.angle);p5Y=P*Math.sin(U.startAngle+U.angle);arrPoly=[[0,0],[p1X,p1Y],[p2X,p2Y],[p3X,p3Y],[p4X,p4Y],[p5X,p5Y]];arrPoint=[x,y];if(t(arrPoly,arrPoint)){ctx.restore();return{datapoint:[U.percent,U.data],dataIndex:0,series:U,seriesIndex:S}}}ctx.restore()}}return null}function u(P){n("plothover",P)}function m(P){n("plotclick",P)}function n(P,V){var Q=E.offset();var T=parseInt(V.pageX-Q.left);var R=parseInt(V.pageY-Q.top);var X=v(T,R);if(a.grid.autoHighlight){for(var S=0;S<k.length;++S){var U=k[S];if(U.auto==P&&!(X&&U.series==X.series)){g(U.series)}}}if(X){l(X.series,P)}var W={pageX:V.pageX,pageY:V.pageY};N.trigger(P,[W,X])}function l(Q,R){if(typeof Q=="number"){Q=series[Q]}var P=D(Q);if(P==-1){k.push({series:Q,auto:R});E.triggerRedrawOverlay()}else{if(!R){k[P].auto=false}}}function g(Q){if(Q==null){k=[];E.triggerRedrawOverlay()}if(typeof Q=="number"){Q=series[Q]}var P=D(Q);if(P!=-1){k.splice(P,1);E.triggerRedrawOverlay()}}function D(R){for(var P=0;P<k.length;++P){var Q=k[P];if(Q.series==R){return P}}return -1}function I(S,T){var R=S.getOptions();var P=R.series.pie.radius>1?R.series.pie.radius:o*R.series.pie.radius;T.save();T.translate(C,q);T.scale(1,R.series.pie.tilt);for(i=0;i<k.length;++i){Q(k[i].series)}L(T);T.restore();function Q(U){if(U.angle<=0||isNaN(U.angle)){return}T.fillStyle="rgba(255, 255, 255, "+R.series.pie.highlight.opacity+")";T.beginPath();if(Math.abs(U.angle-Math.PI*2)>1e-9){T.moveTo(0,0)}T.arc(0,0,P,U.startAngle,U.startAngle+U.angle/2,false);T.arc(0,0,P,U.startAngle+U.angle/2,U.startAngle+U.angle,false);T.closePath();T.fill()}}}var a={series:{pie:{show:false,radius:"auto",innerRadius:0,startAngle:3/2,tilt:1,shadow:{left:5,top:15,alpha:0.02},offset:{top:0,left:"auto"},stroke:{color:"#fff",width:1},label:{show:"auto",formatter:function(d,e){return"<div style='font-size:x-small;text-align:center;padding:2px;color:"+e.color+";'>"+d+"<br/>"+Math.round(e.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:0.5}}}};b.plot.plugins.push({init:c,options:a,name:"pie",version:"1.1"})})(jQuery);